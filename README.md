# PromptEmail Outlook Add-in

AI-Powered Email Analysis Outlook Add-in that enhances email productivity through large language model integration.

## Features

- **AI-Powered Email Analysis**: Intelligent email analysis, tone detection, and response assistance
- **Multi-Provider AI Support**: OpenAI-compatible providers, Ollama (local), and custom enterprise endpoints
- **Accessible Interface**: Full keyboard navigation, screen reader support, and high-contrast mode
- **Advanced Settings Management**: Persistent settings with Office 365 roaming and local backup
- **Real-time Email Processing**: Extract email content, analyze sentiment, and generate contextual responses
- **Cloud Telemetry Pipeline**: Secure telemetry via AWS API Gateway with comprehensive Office diagnostic data

## Quick Start

### Prerequisites

- Node.js 16+ and npm
- Outlook Client 
- PowerShell 5.1+ or PowerShell Core 7+ (Windows)
- AWS CLI configured (for deployment to S3)

### Installation

1. Clone the repository and install dependencies:
```bash
npm install
```

2. Build the project:
```bash
npm run build
```

3. Configure deployment environment in `tools\deployment-environments.json`

4. Deploy using the build and deploy script:
```bash
.\tools\deploy_web_assets.ps1 -Environment Prod
```

5. Sideload the manifest (`public\manifest.xml`) in Outlook

For detailed setup instructions, see our comprehensive documentation:
- **[User Guide](docs/USER_GUIDE.md)** - Installation and usage instructions
- **[Deployment Guide](docs/DEPLOYMENT.md)** - Complete deployment procedures

### Development

- **Start development watcher**: `npm run dev`
- **Build for production**: `npm run build`
- **Deploy to environment**: `.\tools\deploy_web_assets.ps1 -Environment Dev`
- **Validate manifest**: `npm run validate-manifest`

## Architecture

### Frontend Stack
- **Framework**: Vanilla JavaScript with ES6 modules and classes
- **Build System**: Webpack 5 with HtmlWebpackPlugin and CopyWebpackPlugin
- **Styling**: CSS3 with CSS custom properties and Grid/Flexbox layouts
- **Bundling**: Separate bundles for taskpane and commands functionality

### Core Services Architecture
- **EmailAnalyzer**: Extracts and processes email content from Office.js API
- **AIService**: Multi-provider AI integration (OpenAI-compatible, Ollama, Custom enterprise providers)
- **SettingsManager**: Dual-storage settings (Office.js roaming + localStorage backup)
- **Logger**: Cloud telemetry via AWS API Gateway with diagnostic data
- **UIController**: State management, loading states, and user feedback
- **AccessibilityManager**: ARIA live regions, keyboard navigation, screen reader support
- **ClassificationDetector**: Email context and classification detection

### Deployment Architecture
- **Hosting**: AWS S3 static website hosting
- **Telemetry Pipeline**: AWS API Gateway → Lambda → EC2 Splunk Enterprise for secure data collection
- **Build Pipeline**: PowerShell-based build and deployment automation
- **Environment Management**: Multi-environment support (Dev/Test/Prod) with URL rewriting
- **Asset Management**: Automated file discovery and URL updating for deployments

### Office Integration
- **Manifest**: Office Add-in manifest with ribbon integration
- **API Integration**: Office.js API for email reading, writing, and user context
- **Extension Points**: Message read and compose command surfaces
- **Authentication**: Office user profile integration

## Telemetry & Monitoring

The application provides comprehensive telemetry for operational monitoring and user experience analytics. All telemetry uses a **flattened event structure** with rich Office diagnostic data transmitted through a secure AWS API Gateway pipeline.

### Telemetry Pipeline Architecture
- **Collection**: Client-side JavaScript Logger service with intelligent batching
- **Transport**: HTTPS POST to AWS API Gateway with CORS support
- **Processing**: AWS Lambda functions for data validation and enrichment  
- **Storage**: Splunk Enterprise on EC2 for analysis and dashboards
- **Retry Logic**: Exponential backoff (1s, 2s, 4s, 8s) for transient failures
- **Error Handling**: Permanent error detection with graceful event dropping

#### Data Privacy & Security

#### Sanitization Rules
- **Email Content**: Never logged or transmitted to protect user privacy
- **Email Subjects**: Never logged in plain text - only hashed for correlation
- **API Keys**: Completely filtered from all telemetry  
- **Email Metadata**: Outlook IDs are hashed for session correlation

## Directory Structure

```
├── public/                     # Built assets (generated by webpack)
├── src/                       # Source code
│   ├── services/              # Core business logic services
│   │   ├── AIService.js       # Multi-provider AI integration
│   │   ├── EmailAnalyzer.js   # Email content extraction
│   │   ├── SettingsManager.js # Persistent settings management
│   │   ├── Logger.js          # Cloud telemetry and logging
│   │   └── ClassificationDetector.js # Email classification
│   ├── ui/                    # UI components and accessibility
│   │   ├── UIController.js    # State management and user feedback
│   │   └── AccessibilityManager.js # ARIA and keyboard navigation
│   ├── taskpane/              # Main application interface
│   │   ├── taskpane.html      # Application HTML template
│   │   └── taskpane.js        # Main application controller
│   ├── commands/              # Office ribbon commands
│   │   ├── commands.html      # Command page template
│   │   └── commands.js        # Ribbon command handlers
│   ├── assets/               # Static assets (CSS, icons)
│   ├── config/                # Configuration files
│   │   ├── ai-providers.json # AI provider configurations
│   │   └── telemetry.json    # Telemetry and logging configuration
│   └── manifest.xml          # Office Add-in manifest
├── tools/                    # Build and deployment scripts
│   ├── deploy_web_assets.ps1  # Main build and deploy automation
│   └── deployment-environments.json # Environment configurations
├── aws-infrastructure/       # AWS deployment templates and scripts
│   ├── cloudformation-template.yaml # Infrastructure as code
│   ├── lambda/               # Lambda function code
│   └── deploy-*.ps1         # Infrastructure deployment scripts
├── docs/                    # Additional documentation
├── webpack.config.js        # Build configuration
└── package.json            # Project dependencies and scripts
```

### AI Provider Configuration

The add-in supports multiple AI providers with automatic model discovery:

- **OpenAI-Compatible**: Standard OpenAI API endpoints with API key authentication
- **Ollama**: Local LLM hosting with automatic model detection via `/api/tags`
- **Custom Enterprise Providers**: Support for additional OpenAI-compatible on-site providers

### Configuration Files
- Provider endpoints and models are defined in `src/config/ai-providers.json`
- Runtime model discovery for Ollama installations  
- Fallback configurations for offline scenarios
- Enterprise configurations for air-gapped environments

## Documentation

This project includes comprehensive documentation for all stakeholders:

- **[Architecture Guide](docs/ARCHITECTURE.md)** - Technical architecture with detailed Mermaid diagrams
- **[Deployment Guide](docs/DEPLOYMENT.md)** - DevOps deployment procedures and automation
- **[User Guide](docs/USER_GUIDE.md)** - End-user installation and feature documentation  
- **[Developer Guide](docs/DEVELOPER_GUIDE.md)** - Development setup and contribution guidelines

## Contributing

1. Fork the repository and create a feature branch
2. Follow the development setup in **[Developer Guide](docs/DEVELOPER_GUIDE.md)**
3. Make your changes with appropriate tests
4. Ensure accessibility compliance (WCAG 2.1 AA)
5. Update documentation as needed
6. Submit a pull request with clear description

For technical architecture details, see **[Architecture Guide](docs/ARCHITECTURE.md)**

## License

MIT License - see LICENSE file for details.
